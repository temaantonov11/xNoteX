[[OS]] 

>[!info] Simple definition
**Контейнер** - процесс, который (благодаря изоляции) считает, что он один в системе.

>[!info] Definition
> **Контейнеризация** (*виртуализация на уровне операционной системы, контейнерная виртуализация, зонная виртуализация*) - метод виртуализация, при котором ядро операционной системы поддерживает **несколько изолированных экземпляров пространства пользователя вместо одного**. Эти экземпляры (обычно называемые контейнерами или зонами) с точки зрения выполняемых в них процессов **идентичны отдельному экземпляру операционной системы**. Для систем на базе Unix эта технология похожа на улучшенную реализацию механизма chroot. Ядро обеспечивает полную изолированность контейнеров, поэтому программы из разных контейнеров не могут взаимодействовать друг на друга.

## Плюсы виртуализации

- Свое собственное ядро, свой собственный "компьютер в компьютере".
- Безопаснее.
- бОльшая гибкость.
- Честнее по отношению к процессу.
## Плюсы контейнеризации

- Быстрее развертываются.
- Намного меньше накладные ресурсы.
- Меньше по размеру.
- Полная спецификация процесса (легче имплементировать концепцию infrastructure-as-a-code).

Обе концепции не хуже не лучше, каждая для своих задач. На практике в серверных, на host OS ставят виртуальную машину, в которой работают контейнеры.
**host OS -> virt machine (guest OS) -> containers**
## Примеры систем контейнеризации

- Docker
- Podman
- Containerd
## Архитектура изоляции на примере Docker
#### На уровне схемы, какие подсистемы нужно изолировать:
- **Файловую систему (нужен sandbox).**
- **Ресурсы.**
- **Пространство имён**.
#### На чем стоит Docker:
- **chroot jail**
- **cgroups**
- **Пространство имён (namespaces)**

`chroot` - (change root) программа для изменения корневого каталога Linux. Программа, корень которой был перенесён в другой каталог, не может обращаться к файлам вне этого каталога (chroot jail)
`cgroups` - (control groups) набор функционала linux kernel, с помощью которого можно объединять процессы в "контрольные группы", ограничивать и изолировать им ресурсы (CPU, память, I/O). Появление - пример 2007 год. (появление Docker - 2013).
`namespaces`  - пространство имён, функция ядра Linux, позволяющая изолировать и виртуализировать глобальные системные ресурсы множества процессов. Примеры ресурсов, которые можно виртуализировать: **идентификаторы процессов, имена узлов, идентификаторы пользователей, доступ к сетям, межпроцессное взаимодействие** и файловые системы.

## Docker

**Docker** - одна из многих имплементаций концепции контейнеров. Наиболее популярная среди разработчиков. 

>[!info] Def
>**Docker** - chroot на стероидах + жонглирование снимками файловой системы и изоляцией процессов.

### Используется для:

- Стандартизация окружения разработки (dev)
- Окружения сборки (CI)
- Окружение для воспроизведения ошибок (тестирования)
- Окружения для работы (CD)

Docker может работать с Windows-контейнерами, но только на Windows.

**Совет: 1 docker-образ = 1 процесс.**
### Типичные проблемы разработки

- Разные версии компилятора, интерпретатора и библиотек, которые используют компоненты разрабатываемой системы.
- Установка двух версий библиотек на 1 хосте.
- Несоответствие документации и реальных зависимостей.

## Архитектура Docker и его терминология

**Docker** написан на GO и построен на Linux-стеке, имеет клиент-серверную архитектуру.

![[Pasted image 20250127193200.png]]
#### Docker daemon
**Docker daemon** (`dockerd`) - **исполнитель всех команд**, которые пришли по API (управление образами, контейнерами, сетью и томами).
#### Docker client
**Docker client** (`docker`) - **консольный клиент**, который транслирует API вызовы демону.
#### Docker registries
**Docker registries** - registry хранит все образы (можно провести формальную аналогию с git-server и github), которые пользователь может загружать и выгружать методом вызова.
#### Image
**Image** - read-only объект с описанием каким должен быть создаваемый контейнер. Образы создаются на основе других образов и наоборот. Образ можно опеределить в текстовом виде, для этого используется `Dockerfile`, который имеет свой собственный синаксис. Каждая инструкция создает **layer** (слой). Каждый layer простраивается и кешируется, таким образом достигается иерархия образов, переиспользование, а также ускорение построения новых образов.

